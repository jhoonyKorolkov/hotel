# 1.1. Модуль «Пользователи»

Модуль «Пользователи» предназначен для создания, хранения и поиска профилей пользователей. Он используется функциональными модулями для регистрации и аутентификации, а данные пользователя хранятся в MongoDB.

### Модель данных пользователя (`User`)

| Название       | Тип      | Обязательное | Уникальное | По умолчанию |
| -------------- | -------- | ------------ | ---------- | ------------ |
| `_id`          | ObjectId | да           | да         |              |
| `email`        | string   | да           | да         |              |
| `passwordHash` | string   | да           | нет        |              |
| `name`         | string   | да           | нет        |              |
| `contactPhone` | string   | нет          | нет        |              |
| `role`         | string   | да           | нет        | `client`     |

Модуль «Пользователи» реализован как NestJS-модуль и экспортирует сервисы с интерфейсами.

### Интерфейсы

#### `SearchUserParams`

interface SearchUserParams {  
 limit: number;  
 offset: number;  
 email: string;  
 name: string;  
 contactPhone: string;  
}

#### `IUserService`

interface IUserService {  
 create(data: Partial<User>): Promise<User>;  
 findById(id: ID): Promise<User>;  
 findByEmail(email: string): Promise<User>;  
 findAll(params: SearchUserParams): Promise<User[]>;  
}

Поле `role` может принимать одно из значений: `client`, `admin`, `manager`.

При поиске методом `IUserService.findAll()` поля `email`, `name` и `contactPhone` проверяются на частичное совпадение.

---

# 2.3. API Модуля «Аутентификация и авторизация»

Модуль «Аутентификация и авторизация» реализован как отдельный NestJS-модуль. Он предназначен для управления сессиями пользователей и регистрации пользователей. Сессии хранятся в памяти приложения с использованием библиотеки `passport.js`.

Аутентификация производится через модуль «Пользователи». Каждому пользователю назначается одна из ролей: `client`, `admin`, `manager`.

## 2.3.1. Вход

**Описание**  
Стартует сессию пользователя и выставляет Cookies.

**Адрес**  
POST /api/auth/login

**Body-параметры**

{  
 "email": "string",  
 "password": "string"  
}

**Формат ответа**

{  
 "email": "string",  
 "name": "string",  
 "contactPhone": "string"  
}

**Доступ**  
Доступно только не аутентифицированным пользователям.

**Ошибки**

- 401 — если пользователя с указанным email не существует или пароль неверный.

## 2.3.2. Выход

**Описание**  
Завершает сессию пользователя и удаляет Cookies.

**Адрес**  
POST /api/auth/logout

**Формат ответа**  
Пустой ответ.

**Доступ**  
Доступно только аутентифицированным пользователям.

## 2.3.3. Регистрация

**Описание**  
Позволяет создать пользователя с ролью `client` в системе.

**Адрес**  
POST /api/client/register

**Body-параметры**

{  
 "email": "string",  
 "password": "string",  
 "name": "string",  
 "contactPhone": "string"  
}

**Формат ответа**

{  
 "id": "string",  
 "email": "string",  
 "name": "string"  
}

**Доступ**  
Доступно только не аутентифицированным пользователям.

**Ошибки**

- 400 — если email уже занят.

---

# 2.4. API Модуля «Управление пользователями»

## 2.4.1. Создание пользователя

**Описание**  
Позволяет пользователю с ролью `admin` создать пользователя в системе.

**Адрес**  
POST /api/admin/users/

**Body-параметры**

{  
 "email": "string",  
 "password": "string",  
 "name": "string",  
 "contactPhone": "string",  
 "role": "string"  
}

**Формат ответа**

{  
 "id": "string",  
 "email": "string",  
 "name": "string",  
 "contactPhone": "string",  
 "role": "string"  
}

**Доступ**  
Доступно только пользователям с ролью `admin`.

**Ошибки**

- 401 — если пользователь не аутентифицирован;
- 403 — если роль пользователя не `admin`.

## 2.4.2. Получение списка пользователей

**Описание**  
Позволяет пользователю с ролью `admin` или `manager` получить список пользователей.

**Адрес**

- GET /api/admin/users/
- GET /api/manager/users/

**Query-параметры**

- limit — количество записей в ответе;
- offset — сдвиг от начала списка;
- name — фильтр по полю;
- email — фильтр по полю;
- contactPhone — фильтр по полю.

**Формат ответа**

[
 {
 "id": "string",
 "email": "string",
 "name": "string",
 "contactPhone": "string"
 }
]

**Доступ**

- GET /api/admin/users/ — доступно только пользователям с ролью `admin`.
- GET /api/manager/users/ — доступно только пользователям с ролью `manager`.

**Ошибки**

- 401 — если пользователь не аутентифицирован;
- 403 — если роль пользователя не подходит.
